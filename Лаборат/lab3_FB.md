| [<- до лаборних робіт](README.md) | [на основну сторінку курсу](../README.md) |
| --------------------------------- | ----------------------------------------- |
|                                   |                                           |

# Лабораторна робота 3. Робота з функціональними блоками.

## 1. Перевірка роботи таймерів та лічильників.

###### 1.1. Створення та збереження проекту

- Запустіть Machine Expert - Basic
- збережіть проект

###### 1.2. Створення програми з таймером типу TON

- перейдіть на вкладку Programming 
- створіть програму, яка наведена на рисунку 1

![](media3/1.png)

рис.1.

###### 1.3. Компіляція програми 

Зробіть компіляцію програми

###### 1.4. Запуск імітатора ПЛК

- Перейдіть на вкладку Commisioning і запустіть імітатор ПЛК  

- запустіть програму в ПЛК на виконання

- у вікні, яке з'явиться зробіть підтвердження

###### 1.5. Перевірка програми

Аналогічно до послідовності, описаній у [лабораторній №2](lab2_LD.md), перевірте роботу програми за допомогою імітатора ПЛК та таблиці анімації.

Таблиця 1.1. Послідовність перевірки програми користувача

| Крок | %I0.0 <br />(змінювати) | %Q0.0 <br />(змінюватиметься на) | Примітка                |
| ---- | ----------------------- | -------------------------------- | ----------------------- |
| 1    | 0                       | 0                                | після запуску програми  |
| 2    | 1                       | 0-->1 (через 5 сек.)             | %Q0.0 стає рівною 1     |
| 3    | 0                       | 0                                | %Q0.0 повертається до 0 |

###### 1.6 Перевірка роботи таймерів типу TOF та TP

- Змініть тип таймера у вашій програмі на TOF
- Виконайте перевірку роботи програми, аналогічну п 1.5 .

Таблиця 1.2. Послідовність перевірки програми користувача

| Крок | %I0.0 <br />(змінювати) | %Q0.0 <br />(змінюватиметься на) | Примітка                |
| ---- | ----------------------- | -------------------------------- | ----------------------- |
| 1    | 0                       | 0                                | після запуску програми  |
| 2    | 1                       | 1                                | %Q0.0 стає рівною 1     |
| 3    | 0                       | 1-->0 (через 5 сек.)             | %Q0.0 повертається до 0 |

- Змініть тип таймера у вашій програмі на TP
- Виконайте перевірку роботи програми, аналогічну п 1.5 .





| Крок | %I0.0 <br />(змінювати) | %Q0.0 <br />(змінюватиметься на) | Примітка               |
| ---- | ----------------------- | -------------------------------- | ---------------------- |
| 1    | 0                       | 0                                | після запуску програми |
| 2    | 1                       | 1-->0 (через 5 сек.)             | %Q0.0 стає рівною 1    |
| 3    | 0                       | 0                                |                        |



###### 1.7 Перевірка роботи лічильника

- Створіть програму для перевірки роботи лічильника

  ![](media3/10.png)

  Перевірте роботу лічильника за за допомогою імітатора ПЛК або таблиці анімації.

| Крок | %I0.2<br />(змінювати) | %Q0.1 <br />(змінюватиметься на) | Примітка                                            |
| ---- | ---------------------- | -------------------------------- | --------------------------------------------------- |
| 1    | 0                      | 0                                | після запуску програми                              |
| 2    | 0-->1(5 разів)         | 1                                | %Q0.1 стає рівною 1(лічильник дорахував до уставки) |

- Змініть уставку таймера на 9999, та виконайте нову перевірку

| Крок | %I0.1<br />(змінювати) | %I0.2<br />(змінювати) | %Q0.2 <br />(змінюватиметься на) | Примітка                                                     |
| ---- | ---------------------- | ---------------------- | -------------------------------- | ------------------------------------------------------------ |
| 1    | 0                      | 0                      | 0                                | після запуску програми                                       |
| 2    | 0-->1                  | 0                      | 0                                | Плинне значення лічильника стає 9999                         |
| 3    | 0                      | 0-->1                  | 1                                | Плинне значення лічильника стає 0, лічильник сигналізує про переповнення |

- Виконайте ще одну перевірку


| Крок | %I0.0<br />(змінювати) | %I0.3<br />(змінювати) | %Q0.0 <br />(змінюватиметься на) | Примітка                                                     |
| ---- | ---------------------- | ---------------------- | -------------------------------- | ------------------------------------------------------------ |
| 1    | 0                      | 0                      | 0                                | після запуску програми                                       |
| 2    | 0-->1                  | 0                      | 0                                | Плинне значення лічильника стає 0                            |
| 3    | 0                      | 0-->1                  | 1                                | Плинне значення лічильника стає 9999, лічильник сигналізує про переповнення |



## 2. Приклад написання програми користувача з імітацією об'єкта управління.

###### 2.1. Доповнений варіант завдання.

Ознайомтеся з постановкою доповненого завдання для створення програми користувача. Схема технологічної установки, для якої необхідно розробити програму користувача показана на рис.2.1. Нові умови виділено жирним шрифтом. 

![](media3/dia1.png)

рис.2.1. Спрощена апаратурно-технічна схема установки 

Після натискання кнопки "ПУСК", якщо ємність не порожня, повинен відкритися клапан `LVS3`, і присутня в ємності рідина повинна вивантажитися з неї.  Якщо (коли) ємність буде порожня необхідно закрити клапан `LVS3` і відкрити клапан `LVS1` і почати її наповнювати до спрацювання середнього рівня. Після цього необхідно закрити клапан `LVS1` і відкрити `LVS2` для заповнення ємності до верхнього рівня. Потім клапан `LVS2` треба закрити і відкрити клапан `TV1` повністю. Після досягнення температури 50°С клапан треба залишити відкритим на 50%. **Після досягнення значення 55°С треба витримати рідину в апараті  впродовж 30 секунд. Після завершення витримки необхідно клапан `TV1` треба закрити повністю і вивантажити рідину з апарату.** Якщо не натиснута кнопка "СТОП" - цикл повинен повторюватися.

###### 2.2. Спрощена імітаційна модель об'єкта

Відповідно до завдання, даний об'єкт має два технологічних параметра, які потребують імітаційного моделювання - рівень в апараті (представлений трьома сигналізаторами рівня) та температура в апараті (представлений аналоговим датчиком температури).

Суть даного імітаційного моделювання полягає у визначенні якісних впливів різних діянь на технологічний об'єкт на дані технологічні параметри. Кількісні впливи при цьому будуть обиратися довільно, основною метою підбору кількісних впливів буде спрощення процесу відлагоджування.

Суть відлагодження програми за допомогою імітаційної моделі зображено на рисунку нижче.

<img src="media3/40.png"  />

Розглянемо концепцію створення спрощеної імітаційної моделі, вона буде складатися:

- аналіз дій на об'єкт, що впливають на даний параметр (наприклад подача та злив продукту в апарат впливає на рівень, а нагрів - ні).
- аналіз напрямку впливу дій на об'єкт на імітований параметр (наприклад відкритий клапан подачі продукту збільшує рівень, зливу - зменшує).
- вибір величини впливу на імітований параметр (наприклад відкритий клапан зливу буде зменшувати рівень на 1 кожні 100 мс). Даний параметр обирається таким чином, щоб імітація не займала дуже багато чи дуже мало часу.

###### 2.3. Доповнення методики перевірки.

 Табличний вигляд методики перевірки роботи задачі приготування продукту. 

| №    | стан/зміна стану  системи   | SB1  | SB2  | LS1  | LS2  | LS3  | TE1   | LVS1 | LVS2 | LVS3 | TV1  | Примітка                    |
| ---- | --------------------------- | ---- | ---- | ---- | ---- | ---- | ----- | ---- | ---- | ---- | ---- | --------------------------- |
| 1    | початковий  (включення ПЛК) | -    | -    | -    | -    | -    | -     | 0    | 0    | 0    | 0    |                             |
| 2    | Предпуск                    | 0    | -    | -    | -    | -    | -     | 0    | 0    | 0    | 0    |                             |
| 3    | Пуск порожнім               | 1    | 0    | 0    | 0    | 0    | -     | 1    | 0    | 0    | 0    |                             |
| 4    | Пуск не порожнім            | 1    | 0    | 1    | 0    | 0    | -     | 0    | 0    | 1    | 0    | Продовжити перевірку з п.14 |
| 5    | Наповн. нижче рівня LS2     | 0    | 0    | 1    | 0    | 0    | -     | 1    | 0    | 0    | 0    |                             |
| 6    | рівень LS2                  |      |      | 1    | 1    | 0    | -     | 0    | 1    | 0    | 0    |                             |
| 7    | Наповн. нижче рівня LS3     | -    | -    | 1    | 1    | 0    | -     | 0    | 1    | 0    | 0    |                             |
| 8    | рівень LS3                  | -    | -    | 1    | 1    | 1    | -     | 0    | 0    | 0    | 100% |                             |
| 9    | Нагрівання 1                | -    | -    | -    | -    | -    | <50°С | 0    | 0    | 0    | 100% |                             |
| 10   | температура 50°С            | -    | -    | -    | -    | -    | 51°С  | 0    | 0    | 0    | 50%  |                             |
| 11   | Нагрівання 2                | -    | -    | -    | -    | -    | <55°С | 0    | 0    | 0    | 50%  |                             |
| 12   | температура 55°С            | -    | -    | -    | -    | -    | 56°С  | 0    | 0    | 0    | 0    |                             |
| 13   | Витримка 30 секунд          | -    | -    | -    | -    | -    | >56°С | 0    | 0    | 0    | 0    |                             |
| 14   | Вивантаження до LS2         | -    | -    | 1    | 1    | 0    | -     | 0    | 0    | 1    | 0    |                             |
| 15   | Вивантаження до LS1         | -    | -    | 1    | 0    | 0    | -     | 0    | 0    | 1    | 0    |                             |
| 16   | Ємність порожня при "СТОП"  | 0    | 1    | 0    | 0    | 0    | -     | 0    | 0    | 0    | 0    | продовжити перевірку з п.2  |
| 17   | Ємність порожня без "СТОП"  | 0    | 0    | 0    | 0    | 0    | -     | 1    | 0    | 0    | 0    | продовжити перевірку з п.5  |

  `-` - вказує незалежність дій від значення вхідних сигналів, бажано перевіряти що стан системи не міняється при зміні цих вхідних сигналів 

###### 2.4. Створення нових змінних для імітації об'єкта.

| Опис                                     | Змінна | Символьна назва | Примітка |
| ---------------------------------------- | ------ | --------------- | -------- |
| Включення відладки по імітаційній моделі | %M10   | SIM             |          |
| Імітація спрацювання сигналізатора LS1   | %M11   | LS_LO_SIM       |          |
| Імітація спрацювання сигналізатора LS2   | %M12   | LS_MID_SIM      |          |
| Імітація спрацювання сигналізатора LS3   | %M13   | LS_HI_SIM       |          |
| Імітація роботи датчика TE1              | %M100  | TE_SIM          |          |
| Імітація заповнення апарату рідиною      | %M101  | LE_SIM          |          |

- створіть символьні назви для змінних стану з таблиці.
- модифікуйте програму користувача [лабораторної роботи №2](lab2_2_LD.md) відповідно до наведених копій екранів Rung

![](media3/21.png)

![](media3/22.png)

![](media3/23.png)

- Запустіть імітатор ПЛК та запустіть його на виконання.
- Перевірте роботу програми згідно методики перевірки
- Доповніть програму секціями імітації та модифікуйте Rung відповідно до наведених копій екранів

![](media3/24.png)

![](media3/25.png)

![](media3/26.png)

![](media3/27.png)

![](media3/28.png)

![](media3/29.png)

![](media3/30.png)

![](media3/31.png)

![](media3/32.png)

- Запустіть імітатор ПЛК та запустіть його на виконання.

- Перевірте роботу програми згідно наступної методики перевірки:

  - Створіть нову Animation table 

    ![](media3/33.png)

  - Включіть відладку за допомогою імітаційної моделі (SIM-->1)

  - Натисніть кнопку "Пуск" в імітаторі ПЛК

  - Переконайтесь, що процес наповнення почався

  - Натисніть кнопку "Стоп" в імітаторі ПЛК

  - Дочекайтеся завершення та зупинки процесу, при цьому перевіряйте правильність роботи алгоритму. Зверніть увагу, що імітовані параметри можна також вводити в Animation table вручну, це може прискорити процес відладки повільних процесів.

    

## 3. Створення власної програми користувача.

###### 3.1. Відкрийте попередню лабораторну роботу.

 Отримайте індивідуальне завдання від викладача, якщо ще не отримали.

###### 3.2. Модернізуйте код лабораторної роботи, додавши до нього часові затримки. 

Використайте будь-який із типів таймерів (TON, TOF, TP).

###### 3.3. Створіть спрощену імітаційну модель об'єкта та відладьте програму за допомогою імітаційної моделі. 

Усі наведені  матеріали разом з програмою користувача будуть звітом для даної роботи.

